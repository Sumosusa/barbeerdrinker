group_by(count, add = T) %>%
summarise() %>%
ungroup() %>%
mutate(fct_count = as.factor(count) %>% fct_reorder(count, max))
tmp
p <- tmp %>%
ggplot(aes(x = drinker_name, y = fct_count)) +
geom_bar(stat = "identity") +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
p
tmp <- left_join(subset(bills, bills$item %in% tbl_df(beer)[[1]]),
tsns,
by = "transaction_id") %>%
select(drinker_name, item, quantity) %>%
group_by(drinker_name, item) %>%
mutate(count = sum(quantity)) %>%
group_by(count, add = T) %>%
summarise() %>%
ungroup() %>%
arrange(desc(count))
p <- tmp %>%
ggplot(aes(x = drinker_name, y = count)) +
geom_bar(stat = "identity") +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
p
p <- tmp %>%
ggplot(aes(x = reorder(drinker_name, count), y = count)) +
geom_bar(stat = "identity") +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
p
tmp
g_beers_topbars(beer)
source('~/r/barbeerdrinker/barbeerdrinker-app/graphs.R')
g_beers_topcustomers(beer)
drinker <- drinkers$name
drinker
t_drinkers_orders(drinker)
# given a drinker, show all his/her transactions ordered by time and grouped by different bars
# requires: ..., transactions
t_drinkers_orders <- function(drinker) {
ensure_tbls()
tmp <- subset(tsns, tsns$drinker_name %in% tbl_df(drinker)[[1]]) %>%
group_by(bar_name) %>%
arrange(bar_name, transaction_time)
return(tmp)
}
t_drinkers_orders()
t_drinkers_orders(drinker)
t <- t_drinkers_orders(drinker)
View(t)
t_drinkers_bill(drinker)
t_id <- 241653
return(bills %>% subset(bills$transaction_id %in% tbl_df(t_id)[[1]])
}
# show bar graph of beers he/she orders the most
# requires: beers, bills, transactions
g_drinkers_beers <- function(drinker) {
ensure_tbls()
tmp <- bills %>%
subset(bills$transaction_id %in% subset(tsns, tsns$drinker_name %in% tbl_df(drinker)[[1]])$transaction_id) %>%
group_by(item) %>%
count() %>%
ungroup() %>%
top_n(10) # "top" condition
colnames(tmp) <- c("name", "count")
p <- tmp %>%
ggplot(aes(x = reorder(name, count), y = count)) +
geom_bar(stat = "identity") +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
rm(tmp)
return(p)
}
# given a drinker, bar graph of his/her spending in different bars on different dates/weeks/months.
# requires: ..., transactions
g_drinkers_spending <- function(drinker) {
ensure_tbls()
# TODO
}
# given a transaction_id, show all items on that bill
# requires: bills
t_drinkers_bill <- function(t_id) {
)
# given a transaction_id, show all items on that bill
# requires: bills
t_drinkers_bill <- function(t_id) {
ensure_tbls()
return(bills %>% subset(bills$transaction_id %in% tbl_df(t_id)[[1]]))
}
t_drinkers_bill(t_id)
transactions$transaction_Id
ensure_tbls()
tsns$transaction_id
t_id <- tsns$transaction_id
t_drinkers_bill(t_id)
g_drinkers_beers(drinker)
require(tidyverse)
require(plyr)
require(gibble)
t <- require(gibble)
t
t <- require(tidyverse)
t
# ensures the proper installation & loading of R packages
ensure_packages <- function() {
if (!require(markdown))     { install.packages("markdown");     require(markdown)     }
if (!require(tidyverse))    { install.packages("tidyverse");    require(tidyverse)   }
if (!require(pool))         { install.packages("pool");         require(pool)         }
if (!require(RMySQL))       { install.packages("RMySQL");       require(RMySQL)       }
if (!require(shiny))        { install.packages("shiny");        require(shin)         }
if (!require(shinythemes))  { install.packages("shinythemes");  require(shinythemes)  }
}
ensure_packages()
ensure_packages()
shiny::runApp('r/barbeerdrinker/barbeerdrinker-app')
source('~/r/barbeerdrinker/barbeerdrinker-app/utilities.R')
source('~/r/barbeerdrinker/barbeerdrinker-app/utilities.R')
runApp('r/barbeerdrinker/barbeerdrinker-app')
View(g_drinkers_beers)
getwd()
source("utilities.R")
View(g_bars_lgspenders)
g_bars_lgspenders()
g_bars_popularbeers()
g_bars_popularmanfs
g_bars_popularmanfs()
g_beers_topbars()
beer <- beers$name
beer
beer[[1]]
beer
tbl_df(beer)[[1]]
g_beers_topbars(beer)
beer <- "Coors Light"
g_beers_topbars(beer)
c("Coors Light", "Anchor Steam")
beer <- c("Coors Light", "Anchor Steam")
g_beers_topbars(beer)
beer <- beers$name
g_beers_topcustomers(beer)
drinker <- drinkers$name
t_drinkers_orders(drinker)
g_drinkers_beers(drinker)
# show bar graph of beers he/she orders the most
# requires: beers, bills, transactions
g_drinkers_beers <- function(drinker) {
ensure_tbls()
tmp <- bills %>%
subset(bills$transaction_id %in% subset(tsns, tsns$drinker_name %in% tbl_df(drinker)[[1]])$transaction_id) %>%
group_by(item) %>%
count() %>%
ungroup()# %>%
#top_n(10) # "top" condition
colnames(tmp) <- c("name", "count")
p <- tmp %>%
ggplot(aes(x = reorder(name, count), y = count)) +
geom_bar(stat = "identity") +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
rm(tmp)
return(p)
}
g_drinkers_beers(drinker)
g_drinkers_beers(drinker)
runApp('r/barbeerdrinker/barbeerdrinker-app')
runApp('r/barbeerdrinker/barbeerdrinker-app')
runApp('r/barbeerdrinker/barbeerdrinker-app')
runApp('r/barbeerdrinker/barbeerdrinker-app')
runApp('r/barbeerdrinker/barbeerdrinker-app')
runApp('r/barbeerdrinker/barbeerdrinker-app')
runApp('r/barbeerdrinker/barbeerdrinker-app')
runApp('r/barbeerdrinker/barbeerdrinker-app')
if (!require(shinywidgets)) { install.packages("shinywidgets"); require(shinywidgets)  }
if (!require(shinyWidgets)) { install.packages("shinyWidgets"); require(shinyWidgets)  }
library(shinyWidgets)
if (!require(shinyWidgets)) { install.packages("shinyWidgets"); require(shinyWidgets)  }
shiny::runApp('r/barbeerdrinker/barbeerdrinker-app')
runApp('r/barbeerdrinker/barbeerdrinker-app')
shiny::runApp('r/barbeerdrinker/barbeerdrinker-app')
runApp('r/barbeerdrinker/barbeerdrinker-app')
tmp <- tsns %>%
group_by(drinker_name) %>%
mutate(drinker_total = sum(total)) %>%
group_by(drinker_total, add = T) %>%
summarise() %>%
ungroup()
tmp
tmp <- tsns %>%
group_by(drinker_name) %>%
mutate(drinker_total = sum(total)) %>%
group_by(drinker_total, add = T) %>%
summarise() %>%
ungroup() %>%
top_n(drinker_total, 10)
tmp <- tsns %>%
group_by(drinker_name) %>%
mutate(drinker_total = sum(total)) %>%
group_by(drinker_total, add = T) %>%
summarise() %>%
ungroup() %>%
top_n(10, drinker_total)
tmp
tmp <- bills %>%
subset(bills$item %in% beers$name) %>%
group_by(item) %>%
mutate(count = sum(quantity)) %>%
group_by(count, add = T) %>%
summarise() %>%
ungroup()
tmp
tmp <- bills %>%
subset(bills$item %in% beers$name) %>%
group_by(item) %>%
mutate(count = sum(quantity)) %>%
group_by(count, add = T) %>%
summarise() %>%
ungroup()
tmp
bars <- bars$name
reset_tbls()
tmp <- bars$name
tmp
subset(bars, bars$name %in% tbl_df(tmp)[[1]])
tmp <- "Attaboy"
subset(bars, bars$name %in% tbl_df(tmp)[[1]])
bills
left_join(bills, tsns, by = transaction_id)
left_join(bills, tsns, by = "transaction_id")
bar
bar <- tmp
bar
tmp <- left_join(bills, tsns, by = "transaction_id")
tmp <- tmp %>%
subset(tmp$bar_name %in% tbl_df(bar)[[1]]) %>%
subset(bills$item %in% beers$name) %>%
group_by(item) %>%
mutate(count = sum(quantity)) %>%
group_by(count, add = T) %>%
summarise() %>%
ungroup() %>%
top_n(n, count)
tmp <- tmp %>%
subset(tmp$bar_name %in% tbl_df(bar)[[1]])
tmp
tmp <- left_join(bills, tsns, by = "transaction_id")
tmp <- tmp %>%
subset(tmp$bar_name %in% tbl_df(bar)[[1]])
tmp <- tmp %>%
subset(bills$item %in% beers$name) %>%
group_by(item) %>%
mutate(count = sum(quantity)) %>%
group_by(count, add = T) %>%
summarise() %>%
ungroup() %>%
top_n(n, count)
tmp
tmp <- tmp %>%
subset(tmp$item %in% beers$name) %>%
group_by(item) %>%
mutate(count = sum(quantity)) %>%
group_by(count, add = T) %>%
summarise() %>%
ungroup() %>%
top_n(n, count)
n <- 10
tmp <- tmp %>%
subset(tmp$item %in% beers$name) %>%
group_by(item) %>%
mutate(count = sum(quantity)) %>%
group_by(count, add = T) %>%
summarise() %>%
ungroup() %>%
top_n(n, count)
tmp
tsns
tmp <- tsns %>%
subset(tmp$bar_name %in% tbl_df(bar)[[1]])
tmp <- tsns %>%
subset(tsns$bar_name %in% tbl_df(bar)[[1]])
tmp <- tsns %>%
subset(tsns$bar_name %in% tbl_df(bar)[[1]]) %>%
group_by(drinker_name) %>%
mutate(drinker_total = sum(total)) %>%
group_by(drinker_total, add = T) %>%
summarise() %>%
ungroup() %>%
top_n(n, drinker_total)
tmp
bills
tmp <- left_join(bills, tsns, by = "transaction_id")
tmp <- tmp %>%
subset(tmp$bar_name %in% tbl_df(bar)[[1]])
tmp <- tmp %>%
subset(tmp$item %in% beers$name) %>%
group_by(item) %>%
mutate(count = sum(quantity)) %>%
group_by(count, add = T) %>%
summarise() %>%
ungroup() %>%
top_n(n, count)
tmp
tmp <- left_join(bills, tsns, by = "transaction_id")
tmp
tmp <- tmp %>%
subset(tmp$bar_name %in% tbl_df(bar)[[1]])
tmp
tmp <- tmp %>%
subset(tmp$item %in% beers$name)
tmp
tmp <- left_join(bills, tsns, by = "transaction_id")
tmp <- tmp %>%
subset(tmp$bar_name %in% tbl_df(bar)[[1]])
tmp <- tmp %>%
subset(tmp$item %in% beers$name) %>%
group_by(item) %>%
mutate(count = sum(quantity)) %>%
group_by(count, add = T) %>%
summarise() %>%
ungroup() %>%
top_n(n, count)
colnames(tmp) <- c("name",
"count")
tmp <- left_join(tmp, beers, by = "name") %>%
select(manf, count) %>%
group_by(manf) %>%
mutate(total = sum(count)) %>%
group_by(total, add = T) %>%
summarise() %>%
ungroup()
colnames(tmp) <- c("name",
"count")
tmp
bills %>% subset(bills$transaction_id %in% tbl_df(t_id)[[1]])
transactions
tsns
t_id <- 100028
bills %>% subset(bills$transaction_id %in% tbl_df(t_id)[[1]])
runApp('r/barbeerdrinker/barbeerdrinker-app')
tmp
tmp <- left_join(subset(bills, bills$item %in% tbl_df(beer)[[1]]),
tsns,
by = "transaction_id") %>%
select(bar_name, item, quantity) %>%
group_by(bar_name, item) %>%
mutate(count = sum(quantity)) %>%
group_by(count, add = T) %>%
summarise() %>%
ungroup()
beer <- beers$name
tmp <- left_join(subset(bills, bills$item %in% tbl_df(beer)[[1]]),
tsns,
by = "transaction_id") %>%
select(bar_name, item, quantity) %>%
group_by(bar_name, item) %>%
mutate(count = sum(quantity)) %>%
group_by(count, add = T) %>%
summarise() %>%
ungroup()
tmp
tmp <- left_join(subset(bills, bills$item %in% tbl_df(beer)[[1]]),
tsns,
by = "transaction_id") %>%
select(bar_name, item, quantity) %>%
group_by(bar_name, item) %>%
mutate(count = sum(quantity)) %>%
group_by(count, add = T) %>%
summarise() %>%
ungroup() %>%
top_n(count, n)
n <- 10
tmp <- left_join(subset(bills, bills$item %in% tbl_df(beer)[[1]]),
tsns,
by = "transaction_id") %>%
select(bar_name, item, quantity) %>%
group_by(bar_name, item) %>%
mutate(count = sum(quantity)) %>%
group_by(count, add = T) %>%
summarise() %>%
ungroup() %>%
top_n(count, n)
n <- 10
tmp <- left_join(subset(bills, bills$item %in% tbl_df(beer)[[1]]),
tsns,
by = "transaction_id") %>%
select(bar_name, item, quantity) %>%
group_by(bar_name, item) %>%
mutate(count = sum(quantity)) %>%
group_by(count, add = T) %>%
summarise() %>%
ungroup() %>%
top_n(n, count)
tmp
tmp <- left_join(subset(bills, bills$item %in% tbl_df(beer)[[1]]),
tsns,
by = "transaction_id") %>%
select(drinker_name, item, quantity) %>%
group_by(drinker_name, item) %>%
mutate(count = sum(quantity)) %>%
group_by(count, add = T) %>%
summarise() %>%
ungroup()
tmp
runApp('r/barbeerdrinker/barbeerdrinker-app')
tmp <- left_join(subset(bills, bills$item %in% tbl_df(beer)[[1]]),
tsns,
by = "transaction_id") %>%
select(drinker_name, item, quantity) %>%
group_by(drinker_name, item) %>%
mutate(count = sum(quantity)) %>%
group_by(count, add = T) %>%
summarise() %>%
ungroup() %>%
top_n(n, count)
tmp
tmp <- left_join(bills, tsns, by = "transaction_id")
tmp <- tmp %>%
subset(tmp$bar_name %in% tbl_df(bar)[[1]])
tmp <- tmp %>%
subset(tmp$item %in% beers$name) %>%
group_by(item) %>%
mutate(count = sum(quantity)) %>%
group_by(count, add = T) %>%
summarise() %>%
ungroup()
colnames(tmp) <- c("name",
"count")
tmp <- left_join(tmp, beers, by = "name") %>%
select(manf, count) %>%
group_by(manf) %>%
mutate(total = sum(count)) %>%
group_by(total, add = T) %>%
summarise() %>%
ungroup()
tmp
runApp('r/barbeerdrinker/barbeerdrinker-app')
tmp <- bills %>%
subset(bills$transaction_id %in% subset(tsns, tsns$drinker_name %in% tbl_df(drinker)[[1]])$transaction_id) %>%
group_by(item) %>%
count() %>%
ungroup()
drinker <- drinkers$name
tmp <- bills %>%
subset(bills$transaction_id %in% subset(tsns, tsns$drinker_name %in% tbl_df(drinker)[[1]])$transaction_id) %>%
group_by(item) %>%
count() %>%
ungroup()
tmp
tsns
runApp('r/barbeerdrinker/barbeerdrinker-app')
runApp('r/barbeerdrinker/barbeerdrinker-app')
tmp <- bills %>%
subset(bills$transaction_id %in% subset(tsns, tsns$drinker_name %in% tbl_df(drinker)[[1]])$transaction_id) %>%
group_by(item) %>%
count() %>%
ungroup()
colnames(tmp) <- c("name", "count")
tmp <- tmp %>%
arrange(desc(count)) %>%
top_n(n, count)
p <- tmp %>%
ggplot(aes(x = reorder(name, count), y = count)) +
geom_bar(stat = "identity") +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
p
runApp('r/barbeerdrinker/barbeerdrinker-app')
shiny::runApp('r/barbeerdrinker/barbeerdrinker-app')
runApp('r/barbeerdrinker/barbeerdrinker-app')
shiny::runApp('r/barbeerdrinker/barbeerdrinker-app')
View(bars)
View(drinkers)
tmp <- tsns %>%
subset(tsns$bar_name %in% tbl_df(bar)[[1]]) %>%
group_by(drinker_name) %>%
mutate(drinker_total = sum(total)) %>%
group_by(drinker_total, add = T) %>%
summarise() %>%
ungroup() %>%
arrange(desc(drinker_total)) %>%
top_n(n, drinker_total)
bar <- bars$name
tmp <- tsns %>%
subset(tsns$bar_name %in% tbl_df(bar)[[1]]) %>%
group_by(drinker_name) %>%
mutate(drinker_total = sum(total)) %>%
group_by(drinker_total, add = T) %>%
summarise() %>%
ungroup() %>%
arrange(desc(drinker_total)) %>%
top_n(n, drinker_total)
n <- 10
tmp <- tsns %>%
subset(tsns$bar_name %in% tbl_df(bar)[[1]]) %>%
group_by(drinker_name) %>%
mutate(drinker_total = sum(total)) %>%
group_by(drinker_total, add = T) %>%
summarise() %>%
ungroup() %>%
arrange(desc(drinker_total)) %>%
top_n(n, drinker_total)
tmp
bar
tmp
p <- tmp %>%
ggplot(aes(x = reorder(drinker_name, drinker_total), y = drinker_total)) +
geom_bar(stat = "identity") +
labs(title = "Drinkers Who Are Largest Spenders",
caption = "spenders calculated by $ amount spent",
x = "drinker name",
y = "total $ spent") +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
theme(plot.title = element_text(hjust = 0.5))
p
View(p)
shiny::runApp('r/barbeerdrinker/barbeerdrinker-app')
