
<body data-gr-c-s-loaded="true">
  <div class="page">
    <div id="preview-page" class="preview-page" data-autorefresh-url="/__/grip/refresh/">



      <div role="main" class="main-content">
        <div class="container new-discussion-timeline experiment-repo-nav">
          <div class="repository-content">
            <div id="readme" class="readme boxed-group clearfix announce instapaper_body md">

                <h3>
                  <span class="octicon octicon-book"></span>
                  README.md
                </h3>

              <article class="markdown-body entry-content" itemprop="text" id="grip-content">
                <h1>
<a id="user-content-barbeerdrinker-extended" class="anchor" href="http://localhost:6419/#barbeerdrinker-extended" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>barbeerdrinker extended</h1>
<p>rutgers cs 336 project milestone 2</p>
<h4>
<a id="user-content-matthew-handzy-mah376-juan-cruz-jgc112" class="anchor" href="http://localhost:6419/#matthew-handzy-mah376-juan-cruz-jgc112" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Matthew Handzy (mah376), Juan Cruz (jgc112)</h4>
<h2>
<a id="user-content-overview" class="anchor" href="http://localhost:6419/#overview" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Overview</h2>
<p>In this milestone for our project, we were required to populate our database with patterened tuples. In order to accomplish this, we collected information from the internet about popular <code>bars</code> in the tri-state area, a list of the most popular <code>beers</code> in the area, and created synthetic but realistic identities for <code>drinkers</code> at these bars. This required a bit of research and manual data entry, as well as linking the core tables in order to create <code>frequents</code>, <code>likes</code>, and <code>sells</code> tables.</p>
<p>Each individual transaction that occurs at an arbitrary bar is stored in the <code>transactions</code> table. Each transaction has a unique transactionID identifier (PK of the table) which allows us to match transactionID's with individuals for further analysis. The details of each transaction are stored in the <code>bills</code> table, which enumerates which items were purchased on any given transaction. As storing each item on a bill in the <code>transactions</code> table would be redundant and inefficient, we store details of each transaction in a separate table.</p>
<p>We accomplished our data entry with Apple's Pages application (similar to Microsoft Excel), exported tables to csv and uploaded to our AWS RDS instance through MySQLWorkbench. We verified our patterns using SQL queries, and ran simple statistics and number crunching through R in RStudio with the dplyr package before translating . Our final tables are in the <code>/csv/</code> directory, and raw files are stored in the <code>/numbers/</code> directory.</p>
<p>Creating the base tables that are present in the BarBeerDrinker schema used for homework was trivial: all we had to do was generate tuples, then match those tuples on a set of simple conditions. We were pleased with the results.</p>
<p>Generating <code>transactions</code> and <code>bills</code> was more complicated - it required us to create realistic reciepts of transactions, subject to time constraints (bar hours), all while matching drinkers with the bars that they frequent. This was a lot more involved and took more work than expected.</p>
<h2>
<a id="user-content-design" class="anchor" href="http://localhost:6419/#design" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Design</h2>
<h4>
<a id="user-content-bars" class="anchor" href="http://localhost:6419/#bars" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><code>bars</code>
</h4>
<p>The bars were scraped from lists of most popular NYC/Hoboken/Hartford bars, then manually entering them into a csv file. We selected a distribution of 50% NYC bars, 33% Hoboken bars, and 16% Hartford, a design choice we made early on. We figured NYC is more popular than Hoboken which is more popular than Hartford for drinking -- arbitrarily. However, we wanted to ensure that the population would be similarly distributed -- this is explored in the <code>drinkers</code> section.</p>
<h4>
<a id="user-content-beers" class="anchor" href="http://localhost:6419/#beers" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><code>beers</code>
</h4>
<p>We simply compiled a list of popular beers using a list from the internet as well as prior experience with real beer preferences of our friends. The beers on the list were arbitrarily chosen but the set is diverse and wide enough that it encompasses all the most common beers of choice as well as more obscure but still relevant beers. We wanted to include multiple types of beer offered by similar companies, for example: Coors Light, Coors Banquet; Corona Light, Corona Extra; Michelob Light, Michelob Original, Michelob Premium.</p>
<h4>
<a id="user-content-bills" class="anchor" href="http://localhost:6419/#bills" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><code>bills</code>
</h4>
<p>This table was created using an initial vector of 3,800 unique <code>transaction_id</code>'s generated in python. From there, we randomly matched bars to transaction_id's, and from there used the <code>sells</code> table to randomly pick food and drink items to put on the bill.</p>
<h4>
<a id="user-content-drinkers" class="anchor" href="http://localhost:6419/#drinkers" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><code>drinkers</code>
</h4>
<p>As mentioned before, our main objective with drinkers was keeping similar distributions of location to the bars table. Our generated drinkers dataset contained:</p>
<ul>
<li>21.7% CT residents</li>
<li>37.2% NJ residents</li>
<li>41.1% NY residents</li>
</ul>
<p>We found this acceptable, and given the slight difference in distributions could make for some interesting 'finds' later in the data. We then generated unique, random names (pairs of first, last) and assigned phone numbers and street addresses to them. The <code>city</code> column is populated with real cities that are within realistic commuting distance to the city where they frequent bars, rather than have cross-state drinkers.</p>
<h4>
<a id="user-content-frequents" class="anchor" href="http://localhost:6419/#frequents" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><code>frequents</code>
</h4>
<p>In order to link our bars and drinkers, we create a relationship that maps a particular drinker to a particular set of bars that they would frequent. This requires multiple repeat entries in the <code>drinker</code> column, multiple repeat entries in the <code>bar</code> column, however the combination of any given drinker and bar is unique: thus, no redundancy.</p>
<h4>
<a id="user-content-likes" class="anchor" href="http://localhost:6419/#likes" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><code>likes</code>
</h4>
<p>We randomly paired bars with food and drink items, each with price ranges from which values were randomly assigned to each bar/item combination. We had multiples of bars/food/price pairings along with all bars/beers/price pairings from the <code>sells</code> table.</p>
<h4>
<a id="user-content-sells" class="anchor" href="http://localhost:6419/#sells" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><code>sells</code>
</h4>
<p>Our sells table was randomly generated by pairing bars with beers at a given price. A base price was given for each beer, and a random modifier changed the price of the beer from bar-to-bar. The mandatory pattern was asserted when generating this gable.</p>
<h4>
<a id="user-content-transactions" class="anchor" href="http://localhost:6419/#transactions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><code>transactions</code>
</h4>
<p>see: <code>/gen_tables/gen_transac.R</code></p>
<p>Using the bills list as an input, this table was generated by reducing distinct transaction_id's and calculating subtotals, injecting a random tip vector (10-20%), and calculating the final price using 7% tax as stated in the project specs.</p>
<p>Then, we identified which bars had which frequenters associated with them, and picked a random drinker to pay for the transaction. Then, a series of logical checks were applied to ensure the timestamp of the transaction was within the open hours of the bar. This ensured our constraints and patterns were satisfied. This table generation accomplished in RStudio using the tidyverse package.</p>
<h2>
<a id="user-content-constraints" class="anchor" href="http://localhost:6419/#constraints" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Constraints</h2>
<h4>
<a id="user-content-mandatory-constraints" class="anchor" href="http://localhost:6419/#mandatory-constraints" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>mandatory constraints:</h4>
<ul>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="" disabled=""> each bar must also have opening and closing hours</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="" disabled=""> at least 5,000 tuples  in your database instance excluding transactions/bills</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="" disabled=""> at least 20,000 transactions/bills</li>
</ul>
<h4>
<a id="user-content-custom-constraints" class="anchor" href="http://localhost:6419/#custom-constraints" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>custom constraints:</h4>
<ul>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="" disabled=""> at least 60 bars</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="" disabled=""> at least 60 beers</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="" disabled=""> at least 1,000 drinkers</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="" disabled=""> <code>beers</code> table has <code>rating</code> and <code>abv</code> columns</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="" disabled=""> <code>drinkers</code> from NY, NJ, CT</li>
</ul>
<h2>
<a id="user-content-patterns" class="anchor" href="http://localhost:6419/#patterns" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Patterns</h2>
<h4>
<a id="user-content-mandatory-patterns" class="anchor" href="http://localhost:6419/#mandatory-patterns" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>mandatory patterns:</h4>
<ul>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="" disabled=""> <code>transactions</code> cannot occur at times when a given bar is closed</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="" disabled=""> <code>drinkers</code> cannot frequent bars in different state</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="" disabled=""> for any two <code>beers</code> (b1 and b2) different bars may charge differently for b1 and b2, but b1 should either be less expensive than b2 in all bars, or more expensive than b2 in all bars</li>
</ul>
<h4>
<a id="user-content-custom-patterns" class="anchor" href="http://localhost:6419/#custom-patterns" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>custom patterns:</h4>
<ul>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="" disabled=""> distribution of bars with:
<ul>
<li>1/2 (50%) of bars in NY</li>
<li>1/3 (33%) of bars in NJ</li>
<li>1/6 (16%) of bars in CT</li>
</ul>
</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="" disabled=""> bars listed in the following cities:
<ul>
<li>New York City</li>
<li>Hoboken</li>
<li>Hartford</li>
</ul>
</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="" disabled=""> multiple types of beer from same manufacturer for some manf's</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="" disabled=""> reasonably similar drinker home state distributions to bars (within a certain tolerance)</li>
</ul>
<h2>
<a id="user-content-connecting-to-our-real-sql-database" class="anchor" href="http://localhost:6419/#connecting-to-our-real-sql-database" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Connecting to our (real) SQL Database</h2>
<h4>
<a id="user-content-host" class="anchor" href="http://localhost:6419/#host" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>host</h4>
<p><code>barbeerdrinker.cwbowizjcrlm.us-west-1.rds.amazonaws.com</code></p>
<h4>
<a id="user-content-username" class="anchor" href="http://localhost:6419/#username" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>username</h4>
<p><code>juanmatthew</code></p>
<h4>
<a id="user-content-password" class="anchor" href="http://localhost:6419/#password" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>password</h4>
<p><code>password</code></p>
<h4>
<a id="user-content-dbname" class="anchor" href="http://localhost:6419/#dbname" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>dbname</h4>
<p><code>barbeerdrinker</code> (lowercase, case-sensitive)</p>
<h4>
<a id="user-content-port" class="anchor" href="http://localhost:6419/#port" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>port</h4>
<p><code>3306</code></p>
<h2>
<a id="user-content-sql-constraint--pattern-verification" class="anchor" href="http://localhost:6419/#sql-constraint--pattern-verification" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>SQL Constraint &amp; Pattern Verification</h2>
<h4>
<a id="user-content-bars-1" class="anchor" href="http://localhost:6419/#bars-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><code>bars</code>
</h4>
<h6>
<a id="user-content-constraints-1" class="anchor" href="http://localhost:6419/#constraints-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>constraints:</h6>
<ul>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="" disabled=""> at least 60 unique bars</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="" disabled=""> has <code>open</code> and <code>close</code> columns</li>
</ul>
<h6>
<a id="user-content-patterns-1" class="anchor" href="http://localhost:6419/#patterns-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>patterns:</h6>
<ul>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="" disabled=""> 1/2 NY, 1/3 NJ, 1/6 CT distribution</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="" disabled=""> bars in the cities of New York City, Hoboken, and Hartford</li>
</ul>
<h6>
<a id="user-content-verification" class="anchor" href="http://localhost:6419/#verification" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>verification:</h6>
<p>this query verifies the 60 bars constraint</p>
<div class="highlight highlight-source-sql"><pre><span class="pl-k">select</span> if(<span class="pl-c1">count</span>(<span class="pl-k">*</span>) <span class="pl-k">&gt;=</span> <span class="pl-c1">60</span>, <span class="pl-s"><span class="pl-pds">'</span>true<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>false<span class="pl-pds">'</span></span>) <span class="pl-k">as</span> result
<span class="pl-k">from</span> (<span class="pl-k">select distinct</span> name
      <span class="pl-k">from</span> <span class="pl-c1">barbeerdrinker</span>.<span class="pl-c1">bars</span>
      ) tmp</pre></div>
<p>this query verifies the existence of <code>open</code> and <code>close</code> columns</p>
<div class="highlight highlight-source-sql"><pre><span class="pl-k">select</span> open, close
<span class="pl-k">from</span> <span class="pl-c1">barbeerdrinker</span>.<span class="pl-c1">bars</span></pre></div>
<p>this query verifies our claimed distribution pattern</p>
<div class="highlight highlight-source-sql"><pre><span class="pl-k">select</span> left(license, <span class="pl-c1">2</span>) <span class="pl-k">as</span> state, <span class="pl-c1">count</span>(<span class="pl-k">*</span>) <span class="pl-k">as</span> distro
<span class="pl-k">from</span> <span class="pl-c1">barbeerdrinker</span>.<span class="pl-c1">bars</span>
<span class="pl-k">group by</span> state
<span class="pl-k">order by</span> distro <span class="pl-k">desc</span></pre></div>
<p>this query verifies the cities pattern</p>
<div class="highlight highlight-source-sql"><pre><span class="pl-k">select distinct</span> city <span class="pl-k">as</span> result
<span class="pl-k">from</span> <span class="pl-c1">barbeerdrinker</span>.<span class="pl-c1">bars</span></pre></div>
<h4>
<a id="user-content-beers-1" class="anchor" href="http://localhost:6419/#beers-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><code>beers</code>
</h4>
<h6>
<a id="user-content-constraints-2" class="anchor" href="http://localhost:6419/#constraints-2" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>constraints:</h6>
<ul>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="" disabled=""> at least 60 unique beers</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="" disabled=""> has <code>rating</code> and <code>abv</code> columns</li>
</ul>
<h6>
<a id="user-content-patterns-2" class="anchor" href="http://localhost:6419/#patterns-2" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>patterns:</h6>
<ul>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="" disabled=""> multiple types of beer from same manufacturer for some manf's</li>
</ul>
<h6>
<a id="user-content-verification-1" class="anchor" href="http://localhost:6419/#verification-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>verification:</h6>
<p>this query verifies the 60 beers constraint</p>
<div class="highlight highlight-source-sql"><pre><span class="pl-k">select</span> if(<span class="pl-c1">count</span>(<span class="pl-k">*</span>) <span class="pl-k">&gt;=</span> <span class="pl-c1">60</span>, <span class="pl-s"><span class="pl-pds">'</span>true<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>false<span class="pl-pds">'</span></span>) <span class="pl-k">as</span> result
<span class="pl-k">from</span> (<span class="pl-k">select distinct</span> name
      <span class="pl-k">from</span> <span class="pl-c1">barbeerdrinker</span>.<span class="pl-c1">beers</span>
      ) tmp</pre></div>
<p>this query verifies the existence of <code>rating</code> and <code>abv</code> columns</p>
<div class="highlight highlight-source-sql"><pre><span class="pl-k">select</span> rating, abv
<span class="pl-k">from</span> <span class="pl-c1">barbeerdrinker</span>.<span class="pl-c1">beers</span></pre></div>
<p>this query verifies the existence of multiple beers from the same manufacturer (not all have to be true, but at least 1 does)</p>
<div class="highlight highlight-source-sql"><pre><span class="pl-k">select</span> manf, if(<span class="pl-c1">count</span>(manf) <span class="pl-k">&gt;</span> <span class="pl-c1">1</span>, <span class="pl-s"><span class="pl-pds">'</span>true<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>false<span class="pl-pds">'</span></span>) <span class="pl-k">as</span> result
<span class="pl-k">from</span> <span class="pl-c1">barbeerdrinker</span>.<span class="pl-c1">beers</span>
<span class="pl-k">group by</span> manf
<span class="pl-k">order by</span> result <span class="pl-k">desc</span></pre></div>
<h4>
<a id="user-content-drinkers-1" class="anchor" href="http://localhost:6419/#drinkers-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><code>drinkers</code>
</h4>
<h6>
<a id="user-content-constraints-3" class="anchor" href="http://localhost:6419/#constraints-3" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>constraints:</h6>
<ul>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="" disabled=""> at least 1,000 unique drinkers</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="" disabled=""> drinkers from NY, NJ, and CT</li>
</ul>
<h6>
<a id="user-content-patterns-3" class="anchor" href="http://localhost:6419/#patterns-3" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>patterns:</h6>
<ul>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="" disabled=""> <code>drinkers</code> cannot frequent bars in different states</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="" disabled=""> reasonably similar drinker home state distributions to bars (within a certain tolerance)</li>
</ul>
<h6>
<a id="user-content-verification-2" class="anchor" href="http://localhost:6419/#verification-2" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>verification:</h6>
<p>this query verifies the 1,000 drinkers constraint</p>
<div class="highlight highlight-source-sql"><pre><span class="pl-k">select</span> if(<span class="pl-c1">count</span>(<span class="pl-k">*</span>) <span class="pl-k">&gt;=</span> <span class="pl-c1">1000</span>, <span class="pl-s"><span class="pl-pds">'</span>true<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>false<span class="pl-pds">'</span></span>) <span class="pl-k">as</span> result
<span class="pl-k">from</span> (<span class="pl-k">select distinct</span> name
      <span class="pl-k">from</span> <span class="pl-c1">barbeerdrinker</span>.<span class="pl-c1">drinkers</span>
      ) tmp</pre></div>
<p>this query verifies the location constraint</p>
<div class="highlight highlight-source-sql"><pre><span class="pl-k">select distinct</span> right(city, <span class="pl-c1">2</span>) <span class="pl-k">as</span> result
<span class="pl-k">from</span> <span class="pl-c1">barbeerdrinker</span>.<span class="pl-c1">drinkers</span></pre></div>
<p>this query verifies the frequenting pattern</p>
<div class="highlight highlight-source-sql"><pre><span class="pl-k">select</span> <span class="pl-k">*</span>
<span class="pl-k">from</span> (<span class="pl-k">select</span> right(<span class="pl-c1">d</span>.<span class="pl-c1">city</span>, <span class="pl-c1">2</span>) <span class="pl-k">as</span> a, left(<span class="pl-c1">b</span>.<span class="pl-c1">license</span>, <span class="pl-c1">2</span>) <span class="pl-k">as</span> b
		 <span class="pl-k">from</span> drinkers d, bars b, frequents f
		 <span class="pl-k">where</span> <span class="pl-c1">d</span>.<span class="pl-c1">name</span> <span class="pl-k">=</span> <span class="pl-c1">f</span>.<span class="pl-c1">drinker</span>
		 <span class="pl-k">and</span> <span class="pl-c1">f</span>.<span class="pl-c1">bar</span> <span class="pl-k">=</span> <span class="pl-c1">b</span>.<span class="pl-c1">name</span>) tmp
<span class="pl-k">where</span> a <span class="pl-k">&lt;&gt;</span> b</pre></div>
<p>this query verifies that the distributions are not too far off from the distribution of bars in certain states (as stated above)</p>
<div class="highlight highlight-source-sql"><pre><span class="pl-k">select</span> state, distro
<span class="pl-k">from</span> (<span class="pl-k">select</span> state, cast(<span class="pl-c1">count</span>(state) <span class="pl-k">as</span> unsigned) <span class="pl-k">as</span> distro
		 <span class="pl-k">from</span> (<span class="pl-k">select</span> right(city, <span class="pl-c1">2</span>) <span class="pl-k">as</span> state
				   <span class="pl-k">from</span> <span class="pl-c1">barbeerdrinker</span>.<span class="pl-c1">drinkers</span>
				   ) tmp
		 <span class="pl-k">group by</span> state) tmp2</pre></div>
<h4>
<a id="user-content-frequents-1" class="anchor" href="http://localhost:6419/#frequents-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><code>frequents</code>
</h4>
<h6>
<a id="user-content-constraints-4" class="anchor" href="http://localhost:6419/#constraints-4" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>constraints:</h6>
<h6>
<a id="user-content-patterns-4" class="anchor" href="http://localhost:6419/#patterns-4" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>patterns:</h6>
<ul>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="" disabled=""> not all drinkers must frequent bars (# of distinct frequenters &lt;= # of drinkers)</li>
</ul>
<h6>
<a id="user-content-verification-3" class="anchor" href="http://localhost:6419/#verification-3" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>verification:</h6>
<div class="highlight highlight-source-sql"><pre><span class="pl-k">select</span> <span class="pl-c1">count</span>(distinct drinker) <span class="pl-k">as</span> drinker
<span class="pl-k">from</span> <span class="pl-c1">barbeerdrinker</span>.<span class="pl-c1">frequents</span>
<span class="pl-k">where</span> !find_in_set(<span class="pl-c1">1000</span>, drinker)</pre></div>
<h4>
<a id="user-content-likes-1" class="anchor" href="http://localhost:6419/#likes-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><code>likes</code>
</h4>
<h6>
<a id="user-content-constraints-5" class="anchor" href="http://localhost:6419/#constraints-5" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>constraints:</h6>
<ul>
<li>no constraints</li>
</ul>
<h6>
<a id="user-content-patterns-5" class="anchor" href="http://localhost:6419/#patterns-5" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>patterns:</h6>
<ul>
<li>no patterns</li>
</ul>
<h6>
<a id="user-content-verification-4" class="anchor" href="http://localhost:6419/#verification-4" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>verification:</h6>
<div class="highlight highlight-source-sql"><pre>none needed</pre></div>
<h4>
<a id="user-content-sells-1" class="anchor" href="http://localhost:6419/#sells-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><code>sells</code>
</h4>
<h6>
<a id="user-content-constraints-6" class="anchor" href="http://localhost:6419/#constraints-6" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>constraints:</h6>
<h6>
<a id="user-content-patterns-6" class="anchor" href="http://localhost:6419/#patterns-6" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>patterns:</h6>
<ul>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="" disabled=""> for any two <code>beers</code> (b1 and b2) different bars may charge differently for b1 and b2, but b1 should either be less expensive than b2 in all bars, or more expensive than b2 in all bars. since it returns no rows, there are no matches for this.</li>
</ul>
<h6>
<a id="user-content-verification-5" class="anchor" href="http://localhost:6419/#verification-5" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>verification:</h6>
<p>this query verifies the price differential pattern</p>
<div class="highlight highlight-source-sql"><pre><span class="pl-k">select</span> <span class="pl-c1">b</span>.<span class="pl-c1">name</span>, <span class="pl-c1">s1</span>.<span class="pl-c1">bar</span>, <span class="pl-c1">s1</span>.<span class="pl-c1">price</span>, <span class="pl-c1">s2</span>.<span class="pl-c1">bar</span>, <span class="pl-c1">s2</span>.<span class="pl-c1">price</span>
<span class="pl-k">from</span> beers b, sells s1, sells s2
<span class="pl-k">where</span> <span class="pl-c1">b</span>.<span class="pl-c1">name</span> <span class="pl-k">=</span> <span class="pl-c1">s1</span>.<span class="pl-c1">item</span>
<span class="pl-k">and</span> <span class="pl-c1">b</span>.<span class="pl-c1">name</span> <span class="pl-k">=</span> <span class="pl-c1">s2</span>.<span class="pl-c1">item</span>
<span class="pl-k">and</span> <span class="pl-c1">s1</span>.<span class="pl-c1">price</span> <span class="pl-k">&gt;</span> <span class="pl-c1">s2</span>.<span class="pl-c1">price</span>
<span class="pl-k">and</span> <span class="pl-c1">s2</span>.<span class="pl-c1">price</span> <span class="pl-k">&gt;</span> <span class="pl-c1">s1</span>.<span class="pl-c1">price</span></pre></div>
<h4>
<a id="user-content-transactions-1" class="anchor" href="http://localhost:6419/#transactions-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><code>transactions</code>
</h4>
<h6>
<a id="user-content-constraints-7" class="anchor" href="http://localhost:6419/#constraints-7" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>constraints:</h6>
<ul>
<li>none</li>
</ul>
<h6>
<a id="user-content-patterns-7" class="anchor" href="http://localhost:6419/#patterns-7" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>patterns:</h6>
<ul>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="" disabled=""> the drinker must frequent the bar at which the transaction occurred in</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="" disabled=""> <code>transactions</code> cannot occur at times when a given bar is closed</li>
</ul>
<h6>
<a id="user-content-verification-6" class="anchor" href="http://localhost:6419/#verification-6" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>verification:</h6>
<p>this query verifies the frequenting pattern. since it equals 3,800, or the number of transactions, we know all transactions occurred by drinkers that frequent the bars at which the transaction occurred</p>
<div class="highlight highlight-source-sql"><pre><span class="pl-k">select</span> <span class="pl-c1">count</span>(transaction_id) <span class="pl-k">as</span> result
<span class="pl-k">from</span> (<span class="pl-k">select distinct</span> <span class="pl-c1">t</span>.<span class="pl-c1">transaction_id</span>, <span class="pl-c1">d</span>.<span class="pl-c1">name</span>, <span class="pl-c1">t</span>.<span class="pl-c1">bar_name</span>
		 <span class="pl-k">from</span> bills b, drinkers d, frequents f,  transactions t
		 <span class="pl-k">where</span> <span class="pl-c1">d</span>.<span class="pl-c1">name</span> <span class="pl-k">=</span> <span class="pl-c1">f</span>.<span class="pl-c1">drinker</span>
		 <span class="pl-k">and</span> <span class="pl-c1">d</span>.<span class="pl-c1">name</span> <span class="pl-k">=</span> <span class="pl-c1">t</span>.<span class="pl-c1">drinker_name</span>
		 <span class="pl-k">and</span> <span class="pl-c1">b</span>.<span class="pl-c1">transaction_id</span> <span class="pl-k">=</span> <span class="pl-c1">t</span>.<span class="pl-c1">transaction_id</span>
         ) tmp</pre></div>
<p>this query verifies that no transactions occurred when bars were closed for bars that open and close on the same day. no results means no out of bounds transactions.</p>
<div class="highlight highlight-source-sql"><pre><span class="pl-k">select</span> <span class="pl-k">*</span>
<span class="pl-k">from</span> (<span class="pl-k">select</span> cast(<span class="pl-c1">tr</span>.<span class="pl-c1">transaction_time</span> <span class="pl-k">as</span> <span class="pl-k">time</span>) <span class="pl-k">as</span> <span class="pl-k">timestamp</span>, <span class="pl-c1">ba</span>.<span class="pl-c1">open</span>, <span class="pl-c1">ba</span>.<span class="pl-c1">close</span>
      <span class="pl-k">from</span> transactions tr, bars ba
      <span class="pl-k">where</span> <span class="pl-c1">tr</span>.<span class="pl-c1">bar_name</span> <span class="pl-k">=</span> <span class="pl-c1">ba</span>.<span class="pl-c1">name</span>) tmp
<span class="pl-k">where</span> <span class="pl-c1">tmp</span>.<span class="pl-c1">timestamp</span> between <span class="pl-c1">tmp</span>.<span class="pl-c1">open</span> <span class="pl-k">and</span> <span class="pl-c1">tmp</span>.<span class="pl-c1">close</span>
<span class="pl-k">and</span> open <span class="pl-k">&gt;</span> close</pre></div>
<p>this query verifies that no transactions occurred when bars were closed for bars that open and close on different days (PM open, AM close). no results means no out of bounds transactions.</p>
<div class="highlight highlight-source-sql"><pre><span class="pl-k">select</span> <span class="pl-k">*</span>
<span class="pl-k">from</span> (<span class="pl-k">select</span> cast(<span class="pl-c1">tr</span>.<span class="pl-c1">transaction_time</span> <span class="pl-k">as</span> <span class="pl-k">time</span>) <span class="pl-k">as</span> <span class="pl-k">timestamp</span>, <span class="pl-c1">ba</span>.<span class="pl-c1">open</span>, <span class="pl-c1">ba</span>.<span class="pl-c1">close</span>
      <span class="pl-k">from</span> transactions tr, bars ba
      <span class="pl-k">where</span> <span class="pl-c1">tr</span>.<span class="pl-c1">bar_name</span> <span class="pl-k">=</span> <span class="pl-c1">ba</span>.<span class="pl-c1">name</span>) tmp
<span class="pl-k">where</span> !(<span class="pl-c1">tmp</span>.<span class="pl-c1">timestamp</span> between <span class="pl-c1">tmp</span>.<span class="pl-c1">open</span> <span class="pl-k">and</span> <span class="pl-c1">tmp</span>.<span class="pl-c1">close</span>)
<span class="pl-k">and</span> close <span class="pl-k">&gt;</span> open</pre></div>

              </article>
            </div>
          </div>
        </div>
      </div>



  </div>
  <div>&nbsp;</div>
  </div><script>
    function showCanonicalImages() {
      var images = document.getElementsByTagName('img');
      if (!images) {
        return;
      }
      for (var index = 0; index < images.length; index++) {
        var image = images[index];
        if (image.getAttribute('data-canonical-src') && image.src !== image.getAttribute('data-canonical-src')) {
          image.src = image.getAttribute('data-canonical-src');
        }
      }
    }

    function scrollToHash() {
      if (location.hash && !document.querySelector(':target')) {
        var element = document.getElementById('user-content-' + location.hash.slice(1));
        if (element) {
           element.scrollIntoView();
        }
      }
    }

    function autorefreshContent(eventSourceUrl) {
      var initialTitle = document.title;
      var contentElement = document.getElementById('grip-content');
      var source = new EventSource(eventSourceUrl);
      var isRendering = false;

      source.onmessage = function(ev) {
        var msg = JSON.parse(ev.data);
        if (msg.updating) {
          isRendering = true;
          document.title = '(Rendering) ' + document.title;
        } else {
          isRendering = false;
          document.title = initialTitle;
          contentElement.innerHTML = msg.content;
          showCanonicalImages();
        }
      }

      source.onerror = function(e) {
        if (e.readyState === EventSource.CLOSED && isRendering) {
          isRendering = false;
          document.title = initialTitle;
        }
      }
    }

    window.onhashchange = function() {
      scrollToHash();
    }

    window.onload = function() {
      scrollToHash();
    }

    showCanonicalImages();

    var autorefreshUrl = document.getElementById('preview-page').getAttribute('data-autorefresh-url');
    if (autorefreshUrl) {
      autorefreshContent(autorefreshUrl);
    }
  </script>

</body>
